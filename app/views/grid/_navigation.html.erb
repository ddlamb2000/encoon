<script>  function showTable(loadUrl, gridId, updateFlag) {    if ($("#grid-button-" + gridId).attr('checked')) {      if(updateFlag) $.ajax("/" + gridId + "/__set");      $("#grid-" + gridId).        html('<%= escape_javascript(render :partial => "layouts/loading") %>').        show(300).        load(loadUrl);      $("#detail-grid-label-" + gridId).addClass("highlighted");    }     else {      $("#detail-grid-label-" + gridId).removeClass("highlighted");      $("#grid-" + gridId).hide(300);      if(updateFlag) $.ajax("/" + gridId + "/__unset");    }  };</script><% content_for :navigator do %>  <article>    <% if @grid.uuid == GRID_UUID %>      <%= @workspace %>      <%= link_to(icon('expand'),                  show_workspace_path(:workspace => @workspace.display_uri)) %> »    <% else %>      <% if @workspace.uuid != SYSTEM_WORKSPACE_UUID %>        <%= @workspace %>        <%= link_to(icon('expand'),                    show_workspace_path(:workspace => @workspace.display_uri)) %> »      <% end %>      <% if @grid.uuid != WORKSPACE_UUID %>        <%= @grid %>        <%= link_to_unless_current icon('expand'),                                   show_path(                                     :workspace => SYSTEM_WORKSPACE_URI,                                     :grid => GRID_UUID,                                      :row => @grid.display_uri) %> »      <% end %>    <% end %>    <%= @grid.row_title(@row) %>    <hr/>    <% unless @grid.nil? or @row.nil? or @attached_grids.nil? or @attached_grids.empty? %>      <ul>        <% displayed_count = 0 %>        <% for attached_grid in @attached_grids %>          <% filters = attached_grid.get_filters_on_row(@row, @grid.row_title(@row)) %>          <% displayed = (session[:hide_navigator] or @attached_grids.count == 1 or session[filters_uuid(attached_grid, filters)]) %>          <% displayed_count += 1 if displayed %>        <% end %>        <% for attached_grid in @attached_grids %>          <% filters = attached_grid.get_filters_on_row(@row, @grid.row_title(@row)) %>          <% displayed = (displayed_count == 0 or session[:hide_navigator] or @attached_grids.count == 1 or session[filters_uuid(attached_grid, filters)]) %>          <% displayed_count += 1 if displayed %>          <li id="detail-grid-<%= filters_uuid(attached_grid, filters) %>">            <span class="button table-button">              <a id="detail-grid-label-<%= filters_uuid(attached_grid, filters) %>"><%= attached_grid.name %></a>            </span>            <% if attached_grid.filter_column_name.present? and attached_grid.filter_column_name != @grid.to_s %>              <small>(<%= attached_grid.filter_column_name %>)</small>            <% end %>            <%= link_to_unless_current icon('expand'),                                       show_grid_path(                                         :workspace => attached_grid.workspace.display_uri,                                         :grid => attached_grid.display_uri,                                         :filters => filters) %>            <div class="slideButton">              <input type="checkbox"                     id="grid-button-<%= filters_uuid(attached_grid, filters) %>"                     <%= displayed ? 'checked' : '' %> />              <label for="grid-button-<%= filters_uuid(attached_grid, filters) %>"></label>            </div>          </li>          <script>            $("#detail-grid-<%= filters_uuid(attached_grid, filters) %>").hover(              function (event){                $("#grid-<%= filters_uuid(attached_grid, filters) %>").addClass("highlighted");              },              function (event){                $("#grid-<%= filters_uuid(attached_grid, filters) %>").removeClass("highlighted");              }            );            $("#grid-button-<%= filters_uuid(attached_grid, filters) %>").click(function (event){              showTable("<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                        "<%= filters_uuid(attached_grid, filters) %>",                        true);            });            $("#detail-grid-label-<%= filters_uuid(attached_grid, filters) %>").click(function (event){              $("#grid-button-<%= filters_uuid(attached_grid, filters) %>").attr('checked',                !$("#grid-button-<%= filters_uuid(attached_grid, filters) %>").attr('checked'));              showTable("<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                        "<%= filters_uuid(attached_grid, filters) %>",                        true);            });            $(document).ready(function(){              showTable("<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                        "<%= filters_uuid(attached_grid, filters) %>",                        "<%= displayed %>");            });          </script>        <% end %>      </ul>    <% end %>  </article>  <article>    <% if user_signed_in? %>      <span id="more-title" class="button info-button">        <a id="more-label"><%= t 'actions.more' %></a>      </span>      <div class="slideButton">        <input type="checkbox" id="more-button" <%= session[:show_details] ? 'checked' : '' %> />        <label for="more-button"></label>      </div>      <section id="more-content" style="display: none;"></section>      <script>        function showDetails(updateFlag) {          if ($("#more-button").attr('checked')) {            $("#more-content").              html('<%= escape_javascript(render :partial => "layouts/loading") %>').              show(300).              load("<%= url_for(details_path(:grid => @grid.uuid,                                             :row => @row.uuid)) %>");            $("#more-title").addClass("highlighted");          }           else {            $("#more-title").removeClass("highlighted");            $("#more-content").hide(300);            if(updateFlag) $.ajax("/show_details/__unset");          }        };        showDetails(false);        $("#more-button").click(function (event){          showDetails(true);        });        $("#more-label").click(function (event){          $("#more-button").attr('checked', !$("#more-button").attr('checked'));          showDetails(true);        });      </script>    <% else %>      <span class="button user-button">        <%= link_to I18n.t('devise.sign_in'), new_session_path("user") %>      </span>    <% end %>  </article><% end %>