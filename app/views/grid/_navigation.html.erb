<% content_for :navigator do %>  <article>    <% if user_signed_in? %>      <span id="more-title" class="button">        <a id="more-label"><%= t 'actions.more' %></a>      </span>      <small><%= @row %></small>      <div class="slideButton">        <input type="checkbox" id="more-button" <%= session[:show_details] ? 'checked' : '' %> />        <label for="more-button"></label>      </div>      <section id="more-content" style="display: none;"></section>    <% else %>      <span class="button">        <%= link_to new_session_path("user") do %>          <%= icon 'preferences' %>          <%= t 'devise.sign_in' %>        <% end %>      </span>    <% end %>  </article>  <article>    <ul>      <% if @workspace.uuid != @row.uuid and @workspace.uuid != Workspace::SYSTEM_WORKSPACE_UUID %>        <li>          <span class="button">            <%= link_to(@workspace,                        show_workspace_path(:workspace => @workspace.display_uri)) %>          </span>        </li>      <% end %>      <% if @grid.uuid != Grid::ROOT_UUID %>        <li>          <span class="button">            <%= link_to_unless_current @grid.name.html_safe,                                       show_path(                                         :workspace => Workspace::SYSTEM_WORKSPACE_URI,                                         :grid => Grid::ROOT_UUID,                                          :row => @grid.display_uri) %>          </span>        </li>      <% end %>      <% unless @grid.nil? or @row.nil? %>        <% if @row.has_attachment? %>            <% if @row.has_photo? %>              <% for document in @row.row_attachments %>                <% if document.photo? %>                  <li>                    <%= icon "document" %> ???                  </li>                <% end %>              <% end %>             <% end %>            <% if @row.has_document? %>              <% for document in @row.row_attachments %>                <% if document.document? %>                  <li>                    <%= icon "document" %> ???                  </li>                <% end %>              <% end %>            <% end %>         <% end %>        <% unless @attached_grids.nil? or @attached_grids.empty? %>          <% for attached_grid in @attached_grids %>            <% filters = attached_grid.get_filters_on_row(@row) %>            <li id="detail-grid-<%= attached_grid.uuid + "-" + get_filters_uuid(filters) %>">              <span class="button">                <a id="detail-grid-label-<%= attached_grid.uuid + "-" + get_filters_uuid(filters) %>"><%= attached_grid.name %></a>              </span>              <small><%= attached_grid.filter_column_name %></small>              <div class="slideButton">                <input type="checkbox"                       id="grid-button-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>"                       <%= (@attached_grids.count == 1 or session[attached_grid.uuid + '-' + get_filters_uuid(filters)]) ? 'checked' : '' %> />                <label for="grid-button-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>"></label>              </div>            </li>            <script>              $("#detail-grid-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").hover(                function (event){                  $("#grid-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").addClass("highlighted");                },                function (event){                  $("#grid-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").removeClass("highlighted");                }              );              $("#grid-button-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").click(function (event){                var gridId = "<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>";                showTable("#grid-" + gridId,                          "#grid-button-" + gridId,                          "#detail-grid-label-" + gridId,                          "<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                          gridId,                          true);              });              $("#detail-grid-label-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").click(function (event){                var gridId = "<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>";                $("#grid-button-" + gridId).attr('checked', true);                showTable("#grid-" + gridId,                          "#grid-button-" + gridId,                          "#detail-grid-label-" + gridId,                          "<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                          gridId,                          true);              });              $(document).ready(function(){                var gridId = "<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>";                showTable("#grid-" + gridId,                          "#grid-button-" + gridId,                          "#detail-grid-label-" + gridId,                          "<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                          gridId,                          "<%= @attached_grids.count == 1 %>");              });            </script>          <% end %>        <% end %>      <% end %>    </ul>    <script>      function showTable(table, button, detail, loadUrl, flag, updateFlag) {        if ($(button).attr('checked')) {          if(updateFlag) $.ajax("/" + flag + "/__set");          $(table).html('<%= escape_javascript(render :partial => "layouts/loading") %>').show(300).load(loadUrl);          $(detail).addClass("highlighted");        }         else {          $(detail).removeClass("highlighted");          $(table).hide(300);          if(updateFlag) $.ajax("/" + flag + "/__unset");        }      };    </script>  </article><% end %>