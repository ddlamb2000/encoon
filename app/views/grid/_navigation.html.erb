<% content_for :navigator do %>  <article>    <% if user_signed_in? %>      <span id="more-title" class="button">        <a id="more-label"><%= t 'actions.more' %></a>      </span>      <small><%= @row %></small>      <div class="slideButton">        <input type="checkbox" id="more-button" <%= session[:show_details] ? 'checked' : '' %> />        <label for="more-button"></label>      </div>      <section id="more-content" style="display: none;"></section>    <% else %>      <span class="button">        <%= link_to new_session_path("user") do %>          <%= icon 'preferences' %>          <%= t 'devise.sign_in' %>        <% end %>      </span>    <% end %>  </article>  <article>    <ul>      <% if @grid.uuid != Workspace::ROOT_UUID %>        <li>          <span class="button highlighted">            <%= @workspace %>          </span>          <%= link_to(icon('expand'),                      show_workspace_path(:workspace => @workspace.display_uri)) %>        </li>      <% end %>      <% if @grid.uuid != Grid::ROOT_UUID %>        <li>          <span class="button highlighted">            <%= @grid %>          </span>          <%= link_to_unless_current icon('expand'),                                     show_path(                                       :workspace => Workspace::SYSTEM_WORKSPACE_URI,                                       :grid => Grid::ROOT_UUID,                                        :row => @grid.display_uri) %>        </li>      <% end %>      <% unless @grid.nil? or @row.nil? %>        <% if @row.has_attachment? %>            <% if @row.has_photo? %>              <% for document in @row.row_attachments %>                <% if document.photo? %>                  <li>                    <%= icon "document" %> ???                  </li>                <% end %>              <% end %>             <% end %>            <% if @row.has_document? %>              <% for document in @row.row_attachments %>                <% if document.document? %>                  <li>                    <%= icon "document" %> ???                  </li>                <% end %>              <% end %>            <% end %>         <% end %>        <% unless @attached_grids.nil? or @attached_grids.empty? %>          <% for attached_grid in @attached_grids %>            <% filters = attached_grid.get_filters_on_row(@row) %>            <li id="detail-grid-<%= attached_grid.uuid + "-" + get_filters_uuid(filters) %>">              <span class="button">                <a id="detail-grid-label-<%= attached_grid.uuid + "-" + get_filters_uuid(filters) %>"><%= attached_grid.name %></a>              </span>              <small><%= attached_grid.filter_column_name %></small>              <%= link_to_unless_current icon('expand'),                                         show_grid_path(                                           :workspace => attached_grid.workspace.display_uri,                                           :grid => attached_grid.display_uri,                                           :filters => filters) %>              <div class="slideButton">                <input type="checkbox"                       id="grid-button-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>"                       <%= (session[:hide_navigator] or @attached_grids.count == 1 or session[attached_grid.uuid + '-' + get_filters_uuid(filters)]) ? 'checked' : '' %> />                <label for="grid-button-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>"></label>              </div>            </li>            <script>              $("#detail-grid-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").hover(                function (event){                  $("#grid-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").addClass("highlighted");                },                function (event){                  $("#grid-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").removeClass("highlighted");                }              );              $("#grid-button-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").click(function (event){                showTable("<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                          "<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>",                          true);              });              $("#detail-grid-label-<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>").click(function (event){                $("#grid-button-" + gridId).attr('checked', true);                showTable("<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                          "<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>",                          true);              });              $(document).ready(function(){                showTable("<%= url_for(list_path(:grid => attached_grid.uuid, :filters => filters)) %>",                          "<%= attached_grid.uuid + '-' + get_filters_uuid(filters) %>",                          "<%= session[:hide_navigator] or @attached_grids.count == 1 %>");              });            </script>          <% end %>        <% end %>      <% end %>    </ul>    <script>      function showTable(loadUrl, gridId, updateFlag) {        if ($("#grid-button-" + gridId).attr('checked')) {          if(updateFlag) $.ajax("/" + gridId + "/__set");          $("#grid-" + gridId).html('<%= escape_javascript(render :partial => "layouts/loading") %>').show(300).load(loadUrl);          $("#detail-grid-label-" + gridId).addClass("highlighted");        }         else {          $("#detail-grid-label-" + gridId).removeClass("highlighted");          $("#grid-" + gridId).hide(300);          if(updateFlag) $.ajax("/" + gridId + "/__unset");        }      };    </script>  </article><% end %>