<header>
  <h1>
    <%= @row.to_s.html_safe %>
    <span class="detail">
      <%= icon @page_icon %>
      <%= @grid.to_s.html_safe %>
      (<%= @workspace.to_s.html_safe %>)
      <% if not @grid.can_update?(@row) %>
        <span title="<%= t('general.locked') %>"><%= icon "locked" %></span>
      <% end %>
      <%= display_grid_next_versions(@grid, @row).html_safe %>
      <%= display_locale(@row).html_safe if @grid.has_translation? %>
      <% if @row.was_updated? %>
        <span class="detail">
          <%= t 'field.updated' %>
          <%= display_updated_time_by(@row,
                                      @row.who_updated,
                                      @row.update_user_uuid).html_safe %>
        </span>
      <% else %>
        <span class="detail">
          <%= t 'field.created' %>
          <%= display_created_time_by(@row,
                                      @row.who_created,
                                      @row.create_user_uuid).html_safe %>
        </span>
      <% end %>
    </span>
  </h1>
</header>
<% if not @columns.empty? %>
  <table>
    <tbody>
      <% for column in @columns %>
        <%= show_entity(
              column, 
              @row.read_value(column),
              ((column.grid_reference_uuid.present? and @row.read_value(column).present?) ?  
                link_to(@row.read_referenced_name(column),
                        show_path(
                          :workspace => column.grid_reference_uuid,
                          :grid => column.grid_reference_uuid,
                          :row => @row.read_value(column))) : ""),
              @row.read_referenced_name(column),
              @row.read_referenced_description(column)
         ) %>
      <% end %>
    </tbody>
  </table>
<% end %>
<% if @grid.has_translation? and @row_loc.description.present? %>
  <% if not @columns.empty? %><br/><% end %>
  <p><%= @row_loc.description.html_safe %></p>
<% end %>
<% if user_signed_in? and @grid.can_update?(@row) %>
  <div id="actions-<%= @row.uuid %>" 
          class="actions float-actions" 
          style="display: none;">
    <span class="button" title="Update current data or create a new version.">
      <a id="update-<%= @row.uuid %>"><%= icon('edit') %> <%= t 'actions.edit' %></a>
    </span>
    <span class="button" title="Delete current data.">
      <%= link_to icon('remove') + ("&nbsp;" + t('actions.delete')).html_safe, 
         destroy_path(
          :grid => @grid.uuid,
          :row => @row.uuid),
          :confirm => t('message.delete', :name => @row.to_s), 
          :method => :delete %>
    </span>
    <span class="button" title="Add or remove attachment (photo or document) to current data.">
      <%= link_to icon('attachments') + ("&nbsp;" + t('field.attachments')).html_safe, 
         attach_document_path(
            :grid => @grid.uuid,
            :row => @row.uuid),
         :remote => true %>
    </span>
    <span class="button">
      <%= link_to icon('import') + "&nbsp;Import data".html_safe, 
                  import_path(:grid => @grid.uuid) %>
    </span>
    <span class="button" title="Export current data into a XML file.">
      <%= link_to icon('export') + ("&nbsp;" + t('actions.export')).html_safe, 
         export_row_xml_path(
            :workspace => @grid.workspace.uri || @grid.workspace_uuid,
            :grid => @grid.uuid,
            :row => @row.uuid) %>
    </span>
    <script>
      $("#row-<%= @row.uuid %>").hover(
        function (event){
          var left = $(this).offset().left+$(this).width()/2-$("#actions-<%= @row.uuid %>").width()/2;
          var top = $(this).offset().top+5;
          $("#actions-<%= @row.uuid %>").css({left:left,top:top}).fadeIn(300);
          $(this).addClass("highlighted");
        },
        function (event){
          $("#actions-<%= @row.uuid %>").fadeOut(3);
          $(this).removeClass("highlighted");
        }
      );
      $("#update-<%= @row.uuid %>").click(function (event){
        var top = $("#actions-<%= @row.uuid %>").offset().top+15;
        var left = $("#document").offset().left+5;
        var width = $("#document").width()-35;
        $("#row-dialog").html('<%= escape_javascript(render :partial => "layouts/loading") %>');
        $("#row-dialog").css({left:left, top:top, width:width}).show(300);
        $("#row-dialog").load("<%= url_for(edit_path(:grid => @grid.uuid,
                                                     :row => @row.uuid,
                                                     :container => "#row-#{@row.uuid}")) %>");
      });
    </script>
  </div>
<% end %>