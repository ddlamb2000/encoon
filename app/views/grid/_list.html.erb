<% if (user_signed_in? and @grid.can_create_row?(@filters)) or not_all_rows(@table_row_count) %>
  <div id="actions-<%= filters_uuid(@grid, @filters) %>" class="actions float-actions" style="display: none;">
    <% if not_last_page(params[:page], @table_row_count) %>
      <%= calc_next_page(params[:page]) %>
    <% end %>
    <% if not_first_page(params[:page]) %>
      <%= calc_previous_page(params[:page]) %>
      <%= icon('previous') %>
    <% end %>
    <% if user_signed_in? and @grid.can_create_row?(@filters) %>
      <span title="<%= t 'actions.create_help' %>" class="button add-button">
        <a id="create-<%= filters_uuid(@grid, @filters) %>">
          <%= t 'actions.create' %>
        </a>
      </span>
      <script>
        $("#create-<%= filters_uuid(@grid, @filters) %>").click(function (event){
          if(!$('#dialog').is(':visible')){
            var top = $("#actions-<%= filters_uuid(@grid, @filters) %>").offset().top+15;
            var left = $("#document").offset().left+5;
            var width = $("#document").width()-35;
            $("#actions-<%= filters_uuid(@grid, @filters) %>").fadeOut(3);
            $("#document, #document article").addClass("disabled");
            $("a").addClass("disabled");
            $("#dialog").
              html('<%= escape_javascript(render :partial => "layouts/loading") %>').
              css({left:left, top:top, width:width}).
              show(300).
              load("<%= url_for(new_path(:grid => @grid.uuid,
                                         :filters => @filters,
                                         :container => "#grid-" + filters_uuid(@grid, @filters),
                                         :refresh_list => true)) %>");
          }
        });
      </script>
    <% end %>
    <span title="<%= t 'actions.create_help' %>" class="button search-button">
      <a id="search-<%= filters_uuid(@grid, @filters) %>">
        <%= t 'actions.search' %>
      </a>
    </span>
    <% if user_signed_in? and @grid.can_create_row?(@filters) %>
      <span class="button" title="<%= t 'actions.import_help' %>">
        <a id="import-<%= @grid.uuid %>">
          <%= icon('import') %>
          <%= t 'actions.import' %>
        </a>
      </span>
      <script>
        $("#import-<%= @grid.uuid %>").click(function (event){
          if(!$('#dialog').is(':visible')){
            var top = $("#actions-<%= filters_uuid(@grid, @filters) %>").offset().top+15;
            var left = $("#document").offset().left+5;
            var width = $("#document").width()-35;
            $("#actions-<%= @grid.uuid %>").fadeOut(3);
            $("#document, #document article").addClass("disabled");
            $("a").addClass("disabled");
            $("#dialog").
              html('<%= escape_javascript(render :partial => "layouts/loading") %>').
              css({left:left, top:top, width:width}).
              show(300).
              load("<%= url_for(import_path(:grid => @grid.uuid)) %>");
          }
        });
      </script>
      <span title="<%= t 'actions.export_help' %>" class="button">
        <%= link_to export_list_xml_path(
                      :workspace => @grid.workspace.display_uri,
                      :grid => @grid.display_uri,
                      :filters => @filters) do %>
          <%= icon('export') %>
          <%= t 'actions.export' %>
        <% end %>
      </span>
    <% end %>
    <% if user_signed_in? and @grid.can_create_row?(@filters) %>
      <span title="<%= t 'actions.update_grid_help' %>" class="button edit-button">
        <a id="update-grid-<%= filters_uuid(@grid, @filters) %>">
          <%= t 'actions.update_grid' %>
        </a>
      </span>
      <script>
        $("#update-grid-<%= filters_uuid(@grid, @filters) %>").click(function (event){
          if(!$('#dialog').is(':visible')){
            var top = $("#actions-<%= filters_uuid(@grid, @filters) %>").offset().top+15;
            var left = $("#document").offset().left+5;
            var width = $("#document").width()-35;
            $("#actions-<%= filters_uuid(@grid, @filters) %>").fadeOut(3);
            $("#document, #document article").addClass("disabled");
            $("a").addClass("disabled");
            $("#dialog").
              html('<%= escape_javascript(render :partial => "layouts/loading") %>').
              css({left:left, top:top, width:width}).
              show(300).
              load("<%= url_for(edit_path(:grid => GRID_UUID,
                                          :row => @grid.uuid)) %>");
          }
        });
      </script>
    <% end %>
    <% if user_signed_in? and @grid.can_create_row?(@filters) %>
      <span title="<%= t 'actions.column_help' %>" class="button edit-button">
        <a id="attributes-grid-<%= filters_uuid(@grid, @filters) %>">
          <%= t 'actions.columns' %>
        </a>
      </span>
      <script>
        $("#attributes-grid-<%= filters_uuid(@grid, @filters) %>").click(function (event){
          if(!$('#dialog').is(':visible')){
            var top = $(this).offset().top+20;
            var left = $("#document").offset().left+5+$("#document").width()/2-250/2;
            var width = 250;
            $("#actions-<%= filters_uuid(@grid, @filters) %>").fadeOut(3);
            $("#document, #document article").addClass("disabled");
            $("a").addClass("disabled");
            $("#dialog").
              html('<%= escape_javascript(render :partial => "layouts/loading") %>').
              css({left:left, top:top, width:width}).
              show(300).
              load("<%= url_for(attributes_path(:grid => @grid.uuid)) %>");
          }
        });
      </script>
    <% end %>
    <script>
      $("#grid-<%= filters_uuid(@grid, @filters) %>").hover(
        function (event){
          var left = $(this).width()-$("#actions-<%= filters_uuid(@grid, @filters) %>").width();
          $("#actions-<%= filters_uuid(@grid, @filters) %>").css({left:left}).fadeIn(300);
          $(this).addClass("highlighted");
        },
        function (event){
          $("#actions-<%= filters_uuid(@grid, @filters) %>").fadeOut(3);
          $(this).removeClass("highlighted");
        }
      );
    </script>
  </div>
<% end %>
<header>
  <hgroup>
    <%= render :partial => 'breadcrumbs' %>
    <small>
      <%= display_filters(@grid, @filters, defined?(@search) ? @search : nil).html_safe %>
      <% if not (user_signed_in? and @grid.can_create_row?(@filters)) %>
        <span title="<%= t('general.locked') %>" class="locked">&nbsp;</span>
      <% end %>
    </small>
  </hgroup>
  <h3><%= @grid %></h3>
</header>
<% if not @table_rows.nil? and @table_rows.empty? %>
  <%= t('general.no_data') %>
<% end %>
<% unless @table_rows.nil? or
          @table_rows.empty? or
          @table_columns.nil? %>
  <table>
    <thead>
      <tr>
        <th class="list-header-string"></th>
        <% for column in @table_columns %>
          <%= show_header_label(column.kind,
                                column.name.html_safe,
                                column.description.html_safe,
                                true) %>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% for row in @table_rows %>
        <tr id="row-<%= row.uuid %>">
          <td class="list-description">
            <% if user_signed_in? and @grid.can_update_row?(row) %>
              <div id="actions-<%= row.uuid %>" class="actions float-actions" style="display: none;">
                <span class="mini-button edit-button" title="<%= t 'actions.update_help' %>">
                  <a id="update-<%= row.uuid %>"><%= t 'actions.update' %></a>
                </span>
                <script>
                  $("#row-<%= row.uuid %>").hover(
                    function (event){
                      var left = $(this).width()-$("#actions-<%= row.uuid %>").width();
                      $("#actions-<%= row.uuid %>").css({left:left}).show();
                      $(this).addClass("highlighted");
                    },
                    function (event){
                      $("#actions-<%= row.uuid %>").hide();
                      $(this).removeClass("highlighted");
                    }
                  );
                  $("#update-<%= row.uuid %>").click(function (event){
                    if(!$('#dialog').is(':visible')){
                      var top = $("#row-<%= row.uuid %>").offset().top+15;
                      var left = $("#document").offset().left+5;
                      var width = $("#document").width()-35;
                      $("#actions-<%= row.uuid %>").hide();
                      $("#document, #document article").addClass("disabled");
                      $("a").addClass("disabled");
                      $("#dialog").html('<%= escape_javascript(render :partial => "layouts/loading") %>');
                      $("#dialog").css({left:left, top:top, width:width}).show(300);
                      $("#dialog").load("<%= url_for(edit_path(
                                                          :grid => @grid.uuid,
                                                          :row => row.uuid,
                                                          :filters => @filters,
                                                          :container => "#grid-#{filters_uuid(@grid, @filters)}",
                                                          :refresh_list => true)) %>");
                    }
                  });
                </script>
              </div>
            <% end %>
            <span title="<%= truncate_html(row.description.html_safe) %>">
              <% if @grid.has_name %>
                <% if @grid.uuid == WORKSPACE_UUID %>
                  <%= link_to @grid.row_title(row).html_safe,
                              show_workspace_path(
                                :workspace => row.display_uri) %>
                <% elsif @grid.uuid == GRID_UUID %>
                  <%= link_to @grid.row_title(row).html_safe,
                              show_grid_path(
                                :workspace => row.workspace.display_uri,
                                :grid => row.display_uri) %>
                <% else %>
                  <%= link_to @grid.row_title(row).html_safe,
                              show_path(
                                :workspace => @grid.workspace.display_uri,
                                :grid => @grid.display_uri,
                                :row => row.display_uri) %>
                <% end %>
              <% else %>
                <%= link_to icon('entity'),
                            show_path(
                              :workspace => @grid.workspace.display_uri,
                              :grid => @grid.display_uri,
                              :row => row.display_uri) %>
              <% end %>
            </span>
            <%= display_information(row) %>
            <small><%= display_updated_date(row).html_safe %></small>
            <% if user_signed_in? and not @grid.can_update_row?(row) %>
              <span title="<%= t('general.locked') %>" class="locked">&nbsp;</span>
            <% end %>
          </td>
          <% for column in @table_columns %>
            <%= show_entity_in_list(
                    column,
                    row.read_value(column),
                    ((column.workspace_reference.present? and
                      column.grid_reference.present? and
                      row.read_value(column).present?) ?
                        link_to(row.read_referenced_name(column),
                                show_path(
                                  :workspace => column.workspace_reference.display_uri,
                                  :grid => column.grid_reference.display_uri,
                                  :row => row.read_value(column))) :
                        ""),
                    row.read_referenced_name(column)) %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
<small>
  <%= show_collection_count(@table_rows, @table_row_count, params[:page]) %>
  <% if not_all_rows(@table_row_count) %><% end %>
</small>