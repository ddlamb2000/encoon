<script>  $(document).ready(function(){    <% unless @grid_cast.nil? or not @grid_cast.can_select_data? %>      var container = "#row-<%= @grid_cast.uuid + "-" %>";      $(container).load("<%= url_for(:action => :list,                                      :grid_id => @grid_cast.uuid,                                     :id => 0) %>");    <% end %>    <% unless @attached_grids.nil? or @attached_grids.empty? %>      <% for attached_grid in @attached_grids %>        <% filters = [{:column_uuid => attached_grid.column_uuid,                       :row_uuid => @row.uuid,                       :row_name => @row.name}] %>        var container = "#row-<%= attached_grid.uuid + "-" + get_filters_uuid(filters) %>";        $(container).load("<%= url_for(:action => :list,                                        :grid_id => attached_grid.uuid,                                       :id => 0,                                       :filters => filters) %>");      <% end %>    <% end %>    function showNavigator(updateFlag) {      if ($("#navigator-button").attr('checked')) {        if(updateFlag) {          $.ajax("<%= url_for(unset_path(:flag => "hide_navigator")) %>");        }        $("#navigator").show(300);        $("#main-area").removeClass("large-area");        $("#main-area").addClass("main-area");      }       else {        $("#navigator").hide(300);        $("#main-area").removeClass("main-area");        $("#main-area").addClass("large-area");        if(updateFlag) {          $.ajax("<%= url_for(set_path(:flag => "hide_navigator")) %>");        }      }    };    showNavigator(false);    $("#navigator-button").click(function (event){      showNavigator(true);    });    <% if session[:history_table].present? %>      function showHistory() {        if ($("#history-button").attr('checked')) {          $("#history-content").html('<%= escape_javascript(render :partial => "layouts/loading") %>');          $("#history-content").show(300);          $("#history-content").load("<%= url_for(history_path) %>");          $("#history-title").addClass("highlighted");        }         else {          $("#history-title").removeClass("highlighted");          $("#history-content").hide(300);          $.ajax("<%= url_for(unset_path(:flag => "show_history")) %>");        }      };      showHistory();      $("#history-button").click(function (event){        showHistory();      });    <% end %>    <% if user_signed_in? %>      function showDetails() {        if ($("#more-button").attr('checked')) {          $("#more-content").html('<%= escape_javascript(render :partial => "layouts/loading") %>');          $("#more-content").show(300);          $("#more-content").load("<%= url_for(:action => "details", :grid_id => @grid.uuid, :id => @row.id) %>");          $("#more-title").addClass("highlighted");        }         else {          $("#more-title").removeClass("highlighted");          $("#more-content").hide(300);          $.ajax("<%= url_for(unset_path(:flag => "show_details")) %>");        }      };      showDetails();      $("#more-button").click(function (event){        showDetails();      });    <% end %>  });</script>